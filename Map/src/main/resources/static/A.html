<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>

<script src="//code.jquery.com/jquery.min.js"></script>

<link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/css/semantic.min.css" rel="stylesheet" type="text/css">

<script src="/js/bootstrap.min.js" type="text/javascript"></script>
<script src="/js/semantic.min.js" type="text/javascript"></script>

<style type="text/css">
    .title {font-weight:bold;display:block;}
    .bAddr {padding:5px;text-overflow: ellipsis;overflow: hidden;white-space: nowrap;}
  #map {
            position: absolute;
            width: 100%;
            min-height: 100%;
            left: 0;
            top: 0;
        }
    .modes {position: absolute;top: 20px;right: 30px;z-index: 1;}
	#marking {
	   position: fixed;
	   bottom:0px;
	   height:50%;
	   width:100%;
	   background:white;
	   color: black;
	   z-index: 1;
	   display: none;
	   overflow:auto;
	}
	.a{
	   height:90%;
	   width:90%;
	}
</style>

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Insert title here</title>
</head>
<body>

	<div class="a"> 
		<div id="map"></div> 
	</div>
	 
	<p class="modes">
	    <button id="toggle" class="btn btn-info">입력</button>
	</p>

	 <script type="text/javascript">
		 jQuery('#toggle').click(function () {  
		    if($("#marking").css("display") == "none"){   
		        $('#marking').slideDown();  	//보이게한다
		        document.getElementById("toggle").className = "btn btn-danger";
		        $("#toggle").html("취소");
		    } else {  
		        $('#marking').slideUp();  	//안 보이게한다
		        document.getElementById("toggle").className = "btn btn-info";
		        $("#toggle").html("입력");
		        infowindow.close();
		        userMarker.setMap(null);
		    }  
		}); 
		 
		/* var filter = "win16|win32|win64|mac|macintel"; 
		 if ( navigator.platform ) { 
			 if ( filter.indexOf( navigator.platform.toLowerCase() ) < 0 ) { 
				 //mobile 
				 alert('mobile 접속'); 
			 } else { 
				 //pc 
					 alert('pc 접속'); 
				 } 
			 } */

	</script> 
	
	<div id="marking">
		<div class="container"> 
			<div class="row"> 
				<div class="col-md-12"> 
					<div class="page-header"> 
						<h1>카테고리 추가하기</h1> 
					</div> 
					<form method="POST" action="#"> 
						<div class="col-xs-6"> 
							<div class="form-group"> 
								<label for="title">카테고리 이름</label> 
								<input type="text" class="form-control" id="title" name="title" placeholder="이름을 적어주세요."> 
							</div> 
						</div> 
						
						<div class="col-xs-12"> 
							<div class="form-group"> 
								<label for="contents">카테고리 설명</label> 
								<textarea class="form-control" id="contents" name="contents" rows="5" placeholder="설명을 적어주세요."></textarea> 
							</div> 
						</div> 
						<div class="col-xs-12"> 
							<div class="form-group"> 
								<button type="submit" class="btn btn-primary">입력</button> 
								<button type="button" class="btn btn-info" id="findingMarker">지번 주소로 마커 찾기</button>
							</div> 
						</div> 
					</form> 
				</div> 
			</div> 
		</div>
	</div>
	
	<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=ec5b3d5f8ba1f47ea94627cd7422ba47&libraries=services"></script>
	
	<script>
		var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
		    mapOption = {
		        center: new daum.maps.LatLng(37.55087, 126.92555), // 지도의 중심좌표
		        level: 3, // 지도의 확대 레벨
		        mapTypeId : daum.maps.MapTypeId.ROADMAP // 지도종류
		    }; 

		// 지도를 생성한다 
		var map = new daum.maps.Map(mapContainer, mapOption); 
		
		// 주소-좌표 변환 객체를 생성합니다
		var geocoder = new daum.maps.services.Geocoder();

		var userMarker = new daum.maps.Marker(), // 클릭한 위치를 표시할 마커입니다
		    infowindow = new daum.maps.InfoWindow({zindex:1}); // 클릭한 위치에 대한 주소를 표시할 인포윈도우입니다

		// 지도를 클릭했을 때 클릭 위치 좌표에 대한 주소정보를 표시하도록 이벤트를 등록합니다
		daum.maps.event.addListener(map, 'click', function(mouseEvent) {
		    searchDetailAddrFromCoords(mouseEvent.latLng, function(result, status) {
		        if (status === daum.maps.services.Status.OK) {
		            var detailAddr = !!result[0].road_address ? '<div>도로명주소 : ' + result[0].road_address.address_name + '</div>' : '';
		            detailAddr += '<div>지번 주소 : ' + result[0].address.address_name + '</div>';
		            
		            var content = '<div class="bAddr">' +
		                            '<span class="title">주소정보</span>' + 
		                            detailAddr + 
		                        '</div>';

		            if($("#marking").css("display") != "none"){
			            // 마커를 클릭한 위치에 표시합니다 
			            userMarker.setPosition(mouseEvent.latLng);
			            userMarker.setMap(map);

			            console.log(typeof(userMarker.getPosition().getLat()));
			            console.log(typeof(String(userMarker.getPosition().getLat().toFixed(6))));
			            console.log(userMarker.getPosition().getLat());
			            console.log(userMarker.getPosition().getLng());
			            
			            // 인포윈도우에 클릭한 위치에 대한 법정동 상세 주소정보를 표시합니다
			            infowindow.setContent(content);
			            infowindow.open(map, userMarker);
		            }
		            
					searchDetailAddrFromCoords(mouseEvent.latLng, displayCenterInfo);
		        }   
		    });
		});
		    
		function searchDetailAddrFromCoords(coords, callback) {
		    // 좌표로 상세 주소 정보를 요청합니다
		    geocoder.coord2Address(coords.getLng(), coords.getLat(), callback);
		}
		
		//비어있는지 아닌지 확인
		var isEmpty = function(value){ 
			if( value == "" || value == null || value == undefined || ( value != null && typeof value == "object" && !Object.keys(value).length ) ){ 
						return true 
					}else{ 
						return false 
				} 
			};
			
		// 주소 입력창에 주소정보를 표출하는 함수입니다
		function displayCenterInfo(result, status) {
		    if (status === daum.maps.services.Status.OK) {
		        for(var i = 0; i < result.length; i++) {
		        	if(isEmpty(result[i].road_address)){
		            	$('#road_address').val("");
		            	$('#address').val(result[i].address.address_name);
		            }else{
		            	$('#road_address').val(result[i].road_address.address_name);
		            	$('#address').val(result[i].address.address_name);
		            }
		                break;
		        }
		    }    
		}
	
		function findingMarker() {
			// 주소로 좌표를 검색합니다
			geocoder.addressSearch($('#address').val(), function(result, status) {
	
			    // 정상적으로 검색이 완료됐으면 
			     if (status === daum.maps.services.Status.OK) {
	
			        var coords = new daum.maps.LatLng(result[0].y, result[0].x);
	
			        // 결과값으로 받은 위치를 마커로 표시합니다
			        userMarker.setPosition(coords);
	
				    searchDetailAddrFromCoords(coords, function(result, status) {
				        if (status === daum.maps.services.Status.OK) {
				            var detailAddr = !!result[0].road_address ? '<div>도로명주소 : ' + result[0].road_address.address_name + '</div>' : '';
				            detailAddr += '<div>지번 주소 : ' + result[0].address.address_name + '</div>';
				            
				            var content = '<div class="bAddr">' +
				                            '<span class="title">주소정보</span>' + 
				                            detailAddr + 
				                        '</div>';

				            if($("#marking").css("display") != "none"){
					            
					            // 인포윈도우에 클릭한 위치에 대한 법정동 상세 주소정보를 표시합니다
					            infowindow.setContent(content);
					            infowindow.open(map, userMarker);
				            }
				            
							searchDetailAddrFromCoords(coords, displayCenterInfo);
				        }   
				    });

			        // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
			        map.setCenter(coords);
			    } 
			}); 
		}   
		
		function validityCheck(){
			
		}
	
	document.getElementById('findingMarker').addEventListener('click', findingMarker); // 이벤트 연결
	</script>
		    
</body>
</html>