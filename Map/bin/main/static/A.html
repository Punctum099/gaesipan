<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>

<script src="//code.jquery.com/jquery.min.js"></script>

<link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/css/semantic.min.css" rel="stylesheet" type="text/css">

<script src="/js/bootstrap.min.js" type="text/javascript"></script>

<style type="text/css">
  #map {
            position: absolute;
            width: 100%;
            min-height: 100%;
            left: 0;
            top: 0;
        }
    .input_marker {position: absolute;top: 20px;right: 30px;z-index: 1;}
    .input_category {position: absolute;top: 70px;right: 30px;z-index: 1;}
	#marking {
	   position: fixed;
	   bottom:0px;
	   height:50%;
	   width:100%;
	   background:white;
	   color: black;
	   z-index: 1;
	   display: none;
	   overflow:auto;
	}
	/* The Modal (background) */
        #myModal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }
    
        /* Modal Content/Box */
        #modal-content {
            background-color: #fefefe;
            margin: 5% auto; /* 5% from the top and centered */
            padding: 20px;
            border: 1px solid #888;  
            width: 32%;
            height: 80%;
            border-radius: 15px;         
            overflow: auto; /* Enable scroll if needed */   
            overflow-x: hidden;                    
        }
        .input_category{
        	z-index:100;
        }
</style>

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Insert title here</title>
</head>
<body>

	<div id="map"></div> 
	   
	<p class="input_marker">
	    <button id="toggle_1" class="btn btn-info">입력</button>
	</p>
	
	<p class="input_category">
	    <button id="toggle_2" class="btn btn-info">카테고리 추가</button>
	</p>

	 <script type="text/javascript">
	 jQuery('#toggle_1').click(function () {  
		    if($("#marking").css("display") == "none"){   
		        $('#marking').slideDown();  	//보이게한다
		        document.getElementById("toggle_1").className = "btn btn-danger";
		        $("#toggle_1").html("취소");
		    } else {  
		        $('#marking').slideUp();  	//안 보이게한다
		        document.getElementById("toggle_1").className = "btn btn-info";
		        $("#toggle_1").html("입력");
		    }  
		}); 
	 
	 function toggle_2 () {  
		    if($("#myModal").css("display") == "none"){   
		    	$('#myModal').fadeIn('fast');  	//보이게한다
		        document.getElementById("toggle_2").className = "btn btn-danger";
		        $("#toggle_2").html("취소");
		    } else {  
		    	$('#myModal').fadeOut('fast');  	//안 보이게한다
		        document.getElementById("toggle_2").className = "btn btn-info";
		        $("#toggle_2").html("카테고리 추가");
		        infowindow.close();
		        userMarker.setMap(null);
		    }  
		}; 
	</script> 
	
	<div id="myModal">
		<div id="modal-content">
			<div id="addCategory">
				<div class="container"> 
					<div class="row"> 
						<div class="col-md-6"> 
							<div class="page-header"> 
								<h1>카테고리 추가하기</h1> 
							</div> 
							<form method="POST" action="#"> 
								<div class="col-xs-10"> 
									<div class="form-group"> 
										<label for="title">카테고리 이름</label> 
										<input type="text" class="form-control" id="title" name="title" placeholder="이름을 적어주세요."> 
									</div> 
								</div> 
								<div class="form-group"> 
									<input type="hidden" id="kind" name="kind" value="user"> 
								</div> 
								<div class="col-xs-2"> 
									<div class="form-group"> 
										<label> 　</label> 
										<button type="submit" class="btn btn-primary">추가</button> 
									</div> 
								</div>
								<table class="table table-striped">
								    <tr>
								      <td>Mark</td>
								      <td>Otto</td>
								      <td>@mdo</td>
								      <td>@mdo</td>
								    </tr>
								</table>
								<div class="col-xs-12"> 
									<span class="close" onClick="toggle_2();"> 닫기 </span>
								</div>
							</form> 
						</div> 
					</div> 
				</div>
			</div>
		</div>
	</div>
	
	<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=ec5b3d5f8ba1f47ea94627cd7422ba47&libraries=services"></script>
	
	<script>
		var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
		    mapOption = {
		        center: new daum.maps.LatLng(37.55087, 126.92555), // 지도의 중심좌표
		        level: 3, // 지도의 확대 레벨
		        mapTypeId : daum.maps.MapTypeId.ROADMAP // 지도종류
		    }; 

		// 지도를 생성한다 
		var map = new daum.maps.Map(mapContainer, mapOption); 
		
		// 주소-좌표 변환 객체를 생성합니다
		var geocoder = new daum.maps.services.Geocoder();

		var userMarker = new daum.maps.Marker(), // 클릭한 위치를 표시할 마커입니다
		    infowindow = new daum.maps.InfoWindow({zindex:1}); // 클릭한 위치에 대한 주소를 표시할 인포윈도우입니다
		
		var markers = [];
		
		function CloseOverlay(overlay) {
		    return function() {
		    	overlay.setMap(null);
		    };
		}
		
		function OpenOverlay(map, marker, overlay) {
		    return function() {
		    	overlay.setMap(map);
		    };
		}
		
		function addMarker(position, category) {
		    		marker = new daum.maps.Marker({
		            position: position, // 마커의 위치
		            title: category
		        });

		    marker.setMap(map); // 지도 위에 마커를 표출합니다
		    markers.push(marker);  // 배열에 생성된 마커를 추가합니다

		    return marker;
		}
		
		// 지도를 클릭했을 때 클릭 위치 좌표에 대한 주소정보를 표시하도록 이벤트를 등록합니다
		daum.maps.event.addListener(map, 'click', function(mouseEvent) {
		    searchDetailAddrFromCoords(mouseEvent.latLng, function(result, status) {
		        if (status === daum.maps.services.Status.OK) {
		            var detailAddr = !!result[0].road_address ? '<div>도로명주소 : ' + result[0].road_address.address_name + '</div>' : '';
		            detailAddr += '<div>지번 주소 : ' + result[0].address.address_name + '</div>';
		            
		            var content = '<div class="bAddr">' +
		                            '<span class="title">주소정보</span>' + 
		                            detailAddr + 
		                        '</div>';

		            if($("#marking").css("display") != "none"){
			            // 마커를 클릭한 위치에 표시합니다 
			            userMarker.setPosition(mouseEvent.latLng);
			            userMarker.setMap(map);
			            
			            // 인포윈도우에 클릭한 위치에 대한 법정동 상세 주소정보를 표시합니다
			            infowindow.setContent(content);
			            infowindow.open(map, userMarker);
		            }
		            
		            $('#x_coordinate').val(String(userMarker.getPosition().getLat()));
		            $('#y_coordinate').val(String(userMarker.getPosition().getLng()));
		            
					searchDetailAddrFromCoords(mouseEvent.latLng, displayCenterInfo);
		        }   
		    });
		});
		    
		function searchDetailAddrFromCoords(coords, callback) {
		    // 좌표로 상세 주소 정보를 요청합니다
		    geocoder.coord2Address(coords.getLng(), coords.getLat(), callback);
		}
		
		//비어있는지 아닌지 확인
		var isEmpty = function(value){ 
			if( value == "" || value == null || value == undefined || ( value != null && typeof value == "object" && !Object.keys(value).length ) ){ 
						return true 
					}else{ 
						return false 
				} 
			};
			
		// 주소 입력창에 주소정보를 표출하는 함수입니다
		function displayCenterInfo(result, status) {
		    if (status === daum.maps.services.Status.OK) {
		        for(var i = 0; i < result.length; i++) {
		        	if(isEmpty(result[i].road_address)){
		            	$('#road_address').val("");
		            	$('#address').val(result[i].address.address_name);
		            }else{
		            	$('#road_address').val(result[i].road_address.address_name);
		            	$('#address').val(result[i].address.address_name);
		            }
		                break;
		        }
		    }    
		}
	
		function findingMarker() {
			// 주소로 좌표를 검색합니다
			geocoder.addressSearch($('#address').val(), function(result, status) {
	
			    // 정상적으로 검색이 완료됐으면 
			     if (status === daum.maps.services.Status.OK) {
	
			        var coords = new daum.maps.LatLng(result[0].y, result[0].x);
	
			        // 결과값으로 받은 위치를 마커로 표시합니다
			        userMarker.setPosition(coords);
	
				    searchDetailAddrFromCoords(coords, function(result, status) {
				        if (status === daum.maps.services.Status.OK) {
				            var detailAddr = !!result[0].road_address ? '<div>도로명주소 : ' + result[0].road_address.address_name + '</div>' : '';
				            detailAddr += '<div>지번 주소 : ' + result[0].address.address_name + '</div>';
				            
				            var content = '<div class="bAddr">' +
				                            '<span class="title">주소정보</span>' + 
				                            detailAddr + 
				                        '</div>';

				            if($("#marking").css("display") != "none"){
					            
					            // 인포윈도우에 클릭한 위치에 대한 법정동 상세 주소정보를 표시합니다
					            infowindow.setContent(content);
					            infowindow.open(map, userMarker);
				            }
				            
							searchDetailAddrFromCoords(coords, displayCenterInfo);
				        }   
				    });
	
			        // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
			        map.setCenter(coords);
			    } 
			}); 
		}   
		
		function validityCheck(){
			
		}
	
		document.getElementById('toggle_2').addEventListener('click', toggle_2); // 이벤트 연결
	</script>
		    
</body>
</html>
